- config:
  - desc: Configuration for Record Endpoint Test
  - testset: "Record Endpoint"
  - url: "http://127.0.0.1:6968/"
  - flask : {path: app , name: create_app}
  - headers: {'Content-Type': 'application/json'}
  - variable_binds: {'mock_zone': 'test.com', 'type1': 'CNAME', 'type2' : 'SRV', 'ttlval' : '1800'}

- test: 
  - name: "TestInputZone"
  - endpoint: 'api/zone'
  - method: "POST"
  - group : "Setup Variables"
  - body: {template: '{"insert":{"fields":{"nm_zone": "$mock_zone"}}}'}
  - headers: {'Content-Type': 'application/json'}
  - extract_binds: 
      - 'id_zone' : {'jmespath' : 'message.id'}
  - validators:
      - assertTrue: {jmespath: 'message.id', test: exists }
- test:
  - name: "TestGetTypeName"
  - group: "Setup Variables"
  - endpoint : 'api/type'
  - method: "POST"
  - body: {template: '{"where":{"tags":{"nm_type": "$type1"}}}'}
  - extract_binds:
      - 'id_type1': {jmespath: 'data[0].id_type'}
- test:
  - name: "GetTypeNameMX"
  - group: "Setup Variables"
  - endpoint: 'api/type'
  - method: "POST"
  - body: {template: '{"where":{"tags":{"nm_type": "$type2"}}}'}
  - extract_binds:
      - 'id_type2': {jmespath: 'data[0].id_type'}
- test:
  - name: "GetTTLID"
  - group: "Setup Variables"
  - endpoint: 'api/ttl'
  - method: "POST"
  - body: {template: '{"where":{"tags":{"nm_ttl": "$ttlval"}}}'}
  - extract_binds:
      - 'id_ttl' : {jmespath: 'data[0].id_ttl'}
- test:
  - name: "TESTRecordInsert"
  - group: "Record Endpoint"
  - method: "POST"
  - endpoint: 'api/record'
  - body: {template: '{"insert":{"fields":{"nm_record":"test1","date_record":"2018070410","id_zone":"$id_zone","id_type":"$id_type1"}}}'}
  - extract_binds:
      - 'id_record1' : {jmespath: 'message.id'}

- test: 
  - name: "TestRemoveZone"
  - endpoint: "api/zone"
  - method: "POST"
  - body: {template: '{"remove":{"tags":{"id_zone":"$id_zone"}}}'}
  - headers: {'Content-Type' : 'application/json'}
  - validators:
      - assertTrue: {jmespath: 'message', test: exists }